machine:
  ghc:
    version: 7.8.3
  environment:
    PATH: $HOME/.cabal/bin:$PATH
    COVERALLS_REPO_TOKEN: SUwFdsOK2VhTVNgcQDXM1cZWSQlxuHpLw

checkout:
  post:
    - git submodule sync
    - git submodule update --init
    - git clone https://github.com/fujimura/hpc-coveralls.git
    - git checkout circleci
    - pushd hpc-coveralls
    - cabal sandbox init
    - cabal install -j --bindir ~/.cabal/bin --datadir ~/.cabal/share
    - popd
    - rm -rfv hpc-coveralls
    - cabal sandbox init
    - git config --global user.email "john@example.com"
    - git config --global user.name "John Doe"

test:
  override:
    - cabal configure --enable-tests --enable-library-coverage --ghc-options=-Werror && cabal build
    - run-cabal-test spec --show-details=always
    - cabal test doctests
  post:
    - hpc-coveralls spec --display-report --print-response --exclude-dir=tes
